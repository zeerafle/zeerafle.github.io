name: Sync to Pinecone

on:
  push:
    branches:
      - main
    paths:
      - '_posts/**'
      - '_portfolio/**'
      - '**.md'
  workflow_dispatch:  # Allow manual trigger

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for proper git operations

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: Install dependencies
        run: |
          pip install pinecone-client langchain-community langchain-text-splitters gitpython python-dotenv unstructured markdown

      - name: Sync to Pinecone
        env:
          PINECONE_API_KEY: ${{ secrets.PINECONE_API_KEY }}
          INDEX_NAME: ${{ secrets.INDEX_NAME }}
        run: python sync_pinecone.py

      - name: Notify completion
        if: success()
        run: echo "✓ Pinecone sync completed successfully"

      - name: Notify failure
        if: failure()
        run: echo "✗ Pinecone sync failed"
